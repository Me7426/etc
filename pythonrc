import atexit
import os
import rlcompleter
import sys

if sys.version_info[0] == 2:
    import gnureadline as readline
else:
    import readline


HISTORYPATH = os.path.expanduser("~/.pyhistory")
if not os.path.isfile(HISTORYPATH):
    open(HISTORYPATH, 'w').close()
readline.parse_and_bind('tab:complete')


def save_history(HISTORYPATH):
    import readline
    readline.write_history_file(HISTORYPATH)

readline.read_history_file(HISTORYPATH)

class ColorChanger(object):
    def __init__(self):
        self.color = self

    def __call__(self, value):
        import random
        import sys
        if value != None:
            print(value)
        choice = random.randint(90, 98)
        sys.ps1 = '\001\033[' + str(choice) + 'm\002>\001\033[0m\002 '
        sys.ps2 = '  '
        del random, sys

sys.displayhook = ColorChanger()

sys.ps1 = '> '
sys.ps2 = '  '

atexit.register(save_history, HISTORYPATH)
del os, atexit, readline, rlcompleter, save_history, HISTORYPATH, ColorChanger, sys
